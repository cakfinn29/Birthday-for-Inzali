<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Birthday Gift for Inzali üéÇ</title>

<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --deep:#6a11cb;
  --soft:#ff6fd8;
  --card-bg: rgba(10, 6, 14, 0.55);
  --card-stroke: rgba(255,255,255,0.18);
  --text: rgba(255,255,255,0.97);

  --pink:#ff4d9d;
  --gold:#ffd86b;
  --shadow: 0 20px 70px rgba(0,0,0,.40);

  --vignette: rgba(0,0,0,.35);
  --warm: rgba(255,120,200,.18);
}

*{box-sizing:border-box;}
html,body{height:100%;}

/* ‚úÖ Scroll fix (so you can reach everything) */
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  color:var(--text);
  background:
    radial-gradient(900px 520px at 50% 26%, rgba(255,255,255,.18), transparent 62%),
    linear-gradient(160deg,var(--deep),var(--soft));
  overflow-x:hidden;
  overflow-y:auto;
  position:relative;
}

/* keep the centered layout */
.page{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 16px 14px;
}

/* ===== Cinematic Intro Layer ===== */
.cinema{
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:0;
  transition: opacity 900ms ease;
  z-index:1;
  background:
    radial-gradient(900px 520px at 50% 25%, rgba(255,255,255,.10), transparent 58%),
    radial-gradient(1200px 700px at 50% 70%, var(--warm), transparent 60%),
    radial-gradient(1000px 700px at 50% 50%, transparent 55%, var(--vignette) 100%);
}
body.cinematic .cinema{ opacity:1; }

.cinema::after{
  content:"";
  position:absolute;
  inset:-40px;
  opacity:.12;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

/* ===== Starry Mode Canvas ===== */
#starsCanvas{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
  opacity:0;
  transition: opacity 500ms ease;
}
body.starry #starsCanvas{ opacity:1; }

/* ===== Toggle Button ===== */
.modeToggle{
  position:fixed;
  top:14px;
  right:14px;
  z-index:5;
  display:flex;
  gap:10px;
  align-items:center;
}
.modeToggle button{
  border:none;
  border-radius:999px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
  background:rgba(0,0,0,.25);
  color:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 30px rgba(0,0,0,.18);
  transition: transform .08s ease, opacity .2s ease;
}
.modeToggle button:active{ transform: translateY(1px); }

/* ===== Floating Side Stickers ===== */
.side{
  position:fixed;
  top:0;
  bottom:0;
  width:300px;
  pointer-events:none;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0.95;
  z-index:0;
  filter: drop-shadow(0 16px 34px rgba(0,0,0,.18));
}
.side.left{left:0;}
.side.right{right:0;transform:scaleX(-1);}

.stack{position:relative;width:100%;height:100%;overflow:hidden;}

.float{
  position:absolute;
  font-size:46px;
  opacity:0;
  animation:rise 6.2s linear infinite;
  will-change: transform, opacity;
}
.float:nth-child(1){ left:10%; }
.float:nth-child(2){ left:28%; }
.float:nth-child(3){ left:46%; }
.float:nth-child(4){ left:64%; }
.float:nth-child(5){ left:82%; }
.float:nth-child(6){ left:18%; }
.float:nth-child(7){ left:36%; }
.float:nth-child(8){ left:54%; }
.float:nth-child(9){ left:72%; }
.float:nth-child(10){left:44%; }
.float:nth-child(11){left:60%; }
.float:nth-child(12){left:24%; }
.float:nth-child(13){left:76%; }
.float:nth-child(14){left:14%; }
.float:nth-child(15){left:88%; }
.float:nth-child(16){left:52%; }

.float:nth-child(odd){animation-duration:7.6s;}
.float:nth-child(even){animation-duration:6.0s;}
.float:nth-child(3n){animation-duration:8.4s;}
.float:nth-child(4n){animation-duration:6.8s;}
.float:nth-child(5n){animation-duration:9.2s;}

.float:nth-child(1){ animation-delay:.1s; }
.float:nth-child(2){ animation-delay:.8s; }
.float:nth-child(3){ animation-delay:1.6s; }
.float:nth-child(4){ animation-delay:2.4s; }
.float:nth-child(5){ animation-delay:3.2s; }
.float:nth-child(6){ animation-delay:4.0s; }
.float:nth-child(7){ animation-delay:4.8s; }
.float:nth-child(8){ animation-delay:5.6s; }
.float:nth-child(9){ animation-delay:6.4s; }
.float:nth-child(10){animation-delay:7.2s; }
.float:nth-child(11){animation-delay:8.0s; }
.float:nth-child(12){animation-delay:8.8s; }
.float:nth-child(13){animation-delay:9.6s; }
.float:nth-child(14){animation-delay:10.4s; }
.float:nth-child(15){animation-delay:11.2s; }
.float:nth-child(16){animation-delay:12.0s; }

@keyframes rise{
  0%{transform:translateY(110vh) rotate(0deg);opacity:0;}
  10%{opacity:.95;}
  90%{opacity:.95;}
  100%{transform:translateY(-20vh) rotate(28deg);opacity:0;}
}

/* ===== Card ===== */
.card{
  width:min(760px,100%);
  background:var(--card-bg);
  border:1px solid var(--card-stroke);
  border-radius:24px;
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  padding:26px 20px;
  text-align:center;
  position:relative;
  z-index:2;
  box-shadow: var(--shadow);
  transform: translateY(10px) scale(.985);
  opacity: 0;
  animation: introIn 1200ms cubic-bezier(.2,.9,.2,1) forwards;
}
@keyframes introIn{
  to{ transform: translateY(0) scale(1); opacity:1; }
}
body.cinematic .card{
  transform: translateY(-2px) scale(1.02);
  transition: transform 900ms ease, filter 900ms ease;
  filter: drop-shadow(0 28px 90px rgba(0,0,0,.40));
}

/* Title */
.title{
  font-family:'Great Vibes',cursive;
  font-size:58px;
  margin:18px 0 8px;
  text-shadow:0 8px 18px rgba(0,0,0,.5);
  position:relative;
  display:inline-block;
}
.title::after{
  content:"";
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:-18px;
  width: 120%;
  height: 36px;
  background: radial-gradient(ellipse at center,
    rgba(255, 210, 240, 0.55) 0%,
    rgba(255, 160, 220, 0.25) 35%,
    rgba(255, 120, 200, 0.00) 70%);
  filter: blur(8px);
  opacity: 0.95;
  pointer-events:none;
}
.sub{font-weight:800;margin-bottom:8px; text-shadow:0 8px 22px rgba(0,0,0,.35);}
.intro{margin:10px 0 8px; text-shadow:0 8px 22px rgba(0,0,0,.35);}
.question{margin:10px 0 14px;font-weight:800; text-shadow:0 8px 22px rgba(0,0,0,.35);}

/* Floating Name Effect */
.floatingName{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
  opacity:.18;
  font-family:'Great Vibes',cursive;
  font-size: clamp(64px, 10vw, 110px);
  display:flex;
  align-items:center;
  justify-content:center;
  transform: rotate(-8deg);
  filter: blur(.2px);
  animation: floatName 6.5s ease-in-out infinite;
}
@keyframes floatName{
  0%,100%{ transform: translateY(0) rotate(-8deg); }
  50%{ transform: translateY(-10px) rotate(-6deg); }
}

/* Continue Button */
#continueBtn{
  background:var(--pink);
  color:#fff;
  border:none;
  padding:12px 22px;
  border-radius:999px;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 16px 34px rgba(0,0,0,.30);
  transition:.35s;
  position:relative;
  z-index:2;
}
#continueBtn.fade{
  opacity:0;
  transform:scale(.85);
  pointer-events:none;
}

/* Confetti Canvas */
#confettiCanvas{
  position:fixed;
  inset:0;
  z-index:4;
  pointer-events:none;
}

/* ===== Gift Area ===== */
.hidden{display:none;}

#giftText{
  margin:16px auto 0;
  max-width:72ch;
  line-height:2.1;
  letter-spacing:.2px;
  text-align:left;
  padding:18px;
  border-radius:16px;
  background:rgba(0,0,0,.22);
  border: 1px solid rgba(255,255,255,.14);
  opacity:0;
  transform:translateY(10px);
  transition:.8s;
  position:relative;
  z-index:2;
}
#giftText.show{opacity:1;transform:translateY(0);}

/* Typewriter lines */
.line{
  margin:0 0 16px 0;
  min-height: 1em;
}
.line:last-child{ margin-bottom: 10px; }

.signature{
  margin-top:10px;
  text-align:right;
  font-weight:800;
  opacity:.95;
}

/* ===== Candle Section ===== */
.candleWrap{
  margin: 14px auto 6px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.cake{
  width: 260px;
  max-width: 92%;
  border-radius: 18px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.14);
  padding: 14px 14px 12px;
  position: relative;
  box-shadow: 0 18px 44px rgba(0,0,0,.20);
}
.cakeTop{
  height: 20px;
  border-radius: 14px;
  background: linear-gradient(90deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
  margin-bottom: 10px;
}
.cakeBody{
  height: 56px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.08));
  position: relative;
  overflow:hidden;
}
.sprinkle{
  position:absolute;
  top: 8px;
  width: 8px; height: 3px;
  border-radius: 999px;
  background: rgba(255,255,255,.75);
  opacity:.9;
}
.candle{
  position:absolute;
  left:50%;
  top:-34px;
  transform: translateX(-50%);
  width: 16px;
  height: 38px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.55));
  box-shadow: 0 8px 16px rgba(0,0,0,.20);
}
.wick{
  position:absolute;
  left:50%;
  top:-7px;
  transform: translateX(-50%);
  width: 3px; height: 8px;
  border-radius: 2px;
  background: rgba(30,30,30,.8);
}
.flame{
  position:absolute;
  left:50%;
  top:-24px;
  transform: translateX(-50%);
  width: 18px; height: 26px;
  border-radius: 50% 50% 50% 50%;
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,.9), rgba(255,200,80,.9) 45%, rgba(255,90,140,.9) 100%);
  filter: drop-shadow(0 0 10px rgba(255,180,90,.95)) drop-shadow(0 0 18px rgba(255,120,200,.55));
  animation: flicker 120ms infinite alternate;
  cursor:pointer;
}
@keyframes flicker{
  from{ transform: translateX(-50%) scale(1) rotate(-2deg); opacity: .95; }
  to{ transform: translateX(-50%) scale(1.06) rotate(2deg); opacity: 1; }
}
.smoke{
  position:absolute;
  left:50%;
  top:-34px;
  transform: translateX(-50%);
  font-size: 18px;
  opacity:0;
  filter: blur(0.2px);
}
.smoke.run{
  animation: smokeUp 1200ms ease-out forwards;
}
@keyframes smokeUp{
  0%{ opacity:0; transform: translateX(-50%) translateY(0) scale(.9); }
  15%{ opacity:.75; }
  100%{ opacity:0; transform: translateX(-50%) translateY(-34px) scale(1.1); }
}
.candleHint{
  font-size: 13px;
  opacity: .92;
  text-shadow: 0 8px 22px rgba(0,0,0,.35);
}

/* ===== Photos (UPDATED) ===== */
.photoWrap{
  margin-top: 14px;
  display:none;
  text-align:center;
}
.photoWrap.show{ display:block; }

.photosGrid{
  margin-top: 10px;
  display:flex;
  gap:14px;
  justify-content:center;   /* ‚úÖ centered */
  align-items:flex-start;
  flex-wrap:wrap;           /* ‚úÖ works on small screens */
}

.photoCard{
  width:min(520px, 100%);
  text-align:center;
}
.photo{
  width:100%;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 50px rgba(0,0,0,.22);
  overflow:hidden;
  background: rgba(0,0,0,.18);
  margin: 0 auto; /* ‚úÖ centered */
  cursor: zoom-in; /* ‚úÖ hint that it's clickable */
}
.photo img{
  width:100%;
  display:block;
  transform: scale(1.03);
  filter: blur(10px) brightness(.95);
  opacity:0;
  transition: opacity 900ms ease, filter 900ms ease, transform 900ms ease;
}
.photo.revealed img{
  opacity:1;
  filter: blur(0) brightness(1);
  transform: scale(1);
}

/* ‚úÖ Clickable "Secret present" button */
.secretBtn{
  margin: 10px auto 0;
  border:none;
  cursor:pointer;
  padding: 10px 14px;
  border-radius: 999px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.14);
  color: rgba(255,255,255,.95);
  font-weight: 800;
  box-shadow: 0 14px 30px rgba(0,0,0,.14);
  transition: transform .08s ease, opacity .2s ease;
}
.secretBtn:active{ transform: translateY(1px); }
.secretBtn.hidden{ display:none; }

.photoCaption{
  padding: 10px 12px;
  font-weight: 700;
  opacity: .92;
  text-align:center;
}

/* ===== Love Counter ===== */
.counter{
  margin-top: 12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
}
.pill{
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 14px 30px rgba(0,0,0,.14);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .2px;
}

/* ===== Lightbox (full-size photo view) ===== */
.lightbox{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.72);
  display:none;
  align-items:center;
  justify-content:center;
  padding: 18px;
  z-index: 9999;
}
.lightbox.show{ display:flex; }
.lightbox img{
  max-width: min(980px, 96vw);
  max-height: 92vh;
  border-radius: 14px;
  box-shadow: 0 24px 80px rgba(0,0,0,.55);
}
.lightbox .close{
  position: fixed;
  top: 14px;
  right: 14px;
  border: none;
  cursor: pointer;
  padding: 10px 12px;
  border-radius: 999px;
  font-weight: 900;
  background: rgba(0,0,0,.35);
  color: rgba(255,255,255,.95);
  border: 1px solid rgba(255,255,255,.18);
}

/* Mobile hide stickers */
@media(max-width:820px){
  .side{display:none;}
}
</style>
</head>

<body>
  <canvas id="starsCanvas"></canvas>
  <canvas id="confettiCanvas"></canvas>
  <div class="cinema"></div>

  <div class="modeToggle">
    <button id="starBtn" type="button">‚≠ê Starry</button>
  </div>

  <!-- Left Stickers -->
  <div class="side left">
    <div class="stack">
      <div class="float">üéà</div><div class="float">üéâ</div><div class="float">üéÇ</div><div class="float">üéÅ</div>
      <div class="float">‚ú®</div><div class="float">üéä</div><div class="float">üíù</div><div class="float">‚≠ê</div>
      <div class="float">üí´</div><div class="float">üå∏</div><div class="float">üßÅ</div><div class="float">üç∞</div>
      <div class="float">üéÜ</div><div class="float">üåü</div><div class="float">üéÄ</div><div class="float">üíñ</div>
    </div>
  </div>

  <!-- Right Stickers -->
  <div class="side right">
    <div class="stack">
      <div class="float">üéà</div><div class="float">üéâ</div><div class="float">üéÇ</div><div class="float">üéÅ</div>
      <div class="float">‚ú®</div><div class="float">üéä</div><div class="float">üíù</div><div class="float">‚≠ê</div>
      <div class="float">üí´</div><div class="float">üå∏</div><div class="float">üßÅ</div><div class="float">üç∞</div>
      <div class="float">üéÜ</div><div class="float">üåü</div><div class="float">üéÄ</div><div class="float">üíñ</div>
    </div>
  </div>

  <div class="page">
    <div class="card">
      <div class="floatingName">Inzali</div>

      <div class="title">Happy Birthday üéÇ</div>
      <div class="sub">A Birthday Gift for <b>Inzali</b> üíù</div>

      <p class="intro" id="introText">
        Click <b>Continue</b> to open your birthday message üéÅ
      </p>

      <div class="question">Ready for your surprise, Inzali? üéâ</div>

      <button id="continueBtn" type="button">Continue üéÅ</button>

      <!-- Candle -->
      <div class="candleWrap hidden" id="candleWrap">
        <div class="cake" id="cake" aria-label="birthday cake">
          <div class="cakeTop"></div>
          <div class="cakeBody" id="cakeBody">
            <span class="sprinkle" style="left:14%; background:rgba(255,120,200,.9)"></span>
            <span class="sprinkle" style="left:28%; background:rgba(255,220,140,.95)"></span>
            <span class="sprinkle" style="left:44%; background:rgba(140,240,255,.9)"></span>
            <span class="sprinkle" style="left:62%; background:rgba(255,255,255,.85)"></span>
            <span class="sprinkle" style="left:78%; background:rgba(255,120,200,.9)"></span>

            <div class="candle">
              <div class="wick"></div>
              <div class="flame" id="flame" title="Click to blow the candle"></div>
              <div class="smoke" id="smoke">üí®</div>
            </div>
          </div>
        </div>

        <div class="candleHint" id="candleHint">‚ú® Click the flame (or cake) to blow the candle</div>
      </div>

      <!-- Message -->
      <div id="giftText" class="hidden"></div>

      <!-- Photo reveal area -->
      <div class="photoWrap" id="photoWrap">
        <div class="photosGrid" id="photosGrid">
          <!-- Photo 1 -->
          <div class="photoCard" id="photoCard1">
            <div class="photo" id="photoBox1">
              <img id="photoImg1" src="photo.jpg" alt="A special photo 1" />
            </div>
          </div>

          <!-- Photo 2 (hidden until secret present) -->
          <div class="photoCard hidden" id="photoCard2">
            <div class="photo" id="photoBox2">
              <img id="photoImg2" src="photo2.jpg" alt="A special photo 2" />
            </div>
          </div>
        </div>

        <button class="secretBtn" id="secretBtn" type="button">üéÅ Secret present</button>
      </div>

      <!-- Love counter -->
      <div class="counter hidden" id="counterRow">
        <div class="pill" id="counterText">‚è≥ Love counter: loading‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <button class="close" id="lightboxClose" type="button">‚úï Close</button>
    <img id="lightboxImg" alt="Full size photo" />
  </div>

  <!-- Audio -->
  <audio id="song" src="birthday.mp3" preload="auto"></audio>
  <audio id="click" src="click.mp3" preload="auto"></audio>

<script>
/* =========================
   SETTINGS YOU CAN EDIT
========================= */
const LOVE_START = new Date("2024-01-01T00:00:00");
const TYPE_SPEED = 18;
const SONG_MAX_VOL = 0.8;

/* =========================
   ELEMENTS
========================= */
const btn = document.getElementById("continueBtn");
const text = document.getElementById("giftText");
const intro = document.getElementById("introText");
const song = document.getElementById("song");
const click = document.getElementById("click");

const candleWrap = document.getElementById("candleWrap");
const flame = document.getElementById("flame");
const cake = document.getElementById("cake");
const smoke = document.getElementById("smoke");
const candleHint = document.getElementById("candleHint");

const photoWrap = document.getElementById("photoWrap");
const photoCard2 = document.getElementById("photoCard2");
const secretBtn = document.getElementById("secretBtn");

const photoBox1 = document.getElementById("photoBox1");
const photoBox2 = document.getElementById("photoBox2");
const photoImg1 = document.getElementById("photoImg1");
const photoImg2 = document.getElementById("photoImg2");

const counterRow = document.getElementById("counterRow");
const counterText = document.getElementById("counterText");

const starBtn = document.getElementById("starBtn");
const starsCanvas = document.getElementById("starsCanvas");
const confettiCanvas = document.getElementById("confettiCanvas");

const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightboxImg");
const lightboxClose = document.getElementById("lightboxClose");

/* =========================
   CINEMATIC INTRO ON LOAD
========================= */
window.addEventListener("load", () => {
  setTimeout(()=>document.body.classList.add("cinematic"), 220);
});

/* =========================
   STAR BACKGROUND MODE
========================= */
let starOn = false;
starBtn.addEventListener("click", ()=>{
  starOn = !starOn;
  document.body.classList.toggle("starry", starOn);
  starBtn.textContent = starOn ? "‚ú® Normal" : "‚≠ê Starry";
});

/* =========================
   STARS CANVAS  (‚úÖ deeper dark sky blue)
========================= */
const sctx = starsCanvas.getContext("2d");
let stars = [];
function resizeStars(){
  starsCanvas.width = window.innerWidth * devicePixelRatio;
  starsCanvas.height = window.innerHeight * devicePixelRatio;
  starsCanvas.style.width = window.innerWidth + "px";
  starsCanvas.style.height = window.innerHeight + "px";

  const count = Math.floor((window.innerWidth * window.innerHeight) / 14000);
  stars = Array.from({length: count}, ()=>({
    x: Math.random() * starsCanvas.width,
    y: Math.random() * starsCanvas.height,
    r: (Math.random()*1.7 + 0.35) * devicePixelRatio,
    a: Math.random()*0.65 + 0.15,
    tw: Math.random()*0.02 + 0.008
  }));
}
function drawStars(){
  sctx.clearRect(0,0,starsCanvas.width, starsCanvas.height);

  // ‚úÖ deep dark sky blue overlay (only visible when starry is on)
  sctx.fillStyle = "rgba(6, 14, 38, 0.30)";
  sctx.fillRect(0,0,starsCanvas.width, starsCanvas.height);

  for(const st of stars){
    st.a += st.tw * (Math.random() > 0.5 ? 1 : -1);
    st.a = Math.max(0.08, Math.min(0.95, st.a));
    sctx.beginPath();
    sctx.fillStyle = `rgba(255,255,255,${st.a})`;
    sctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
    sctx.fill();
  }
  requestAnimationFrame(drawStars);
}
window.addEventListener("resize", resizeStars);
resizeStars();
drawStars();

/* =========================
   CONFETTI
========================= */
const cctx = confettiCanvas.getContext("2d");
let confetti = [];
function resizeConfetti(){
  confettiCanvas.width = window.innerWidth * devicePixelRatio;
  confettiCanvas.height = window.innerHeight * devicePixelRatio;
  confettiCanvas.style.width = window.innerWidth + "px";
  confettiCanvas.style.height = window.innerHeight + "px";
}
window.addEventListener("resize", resizeConfetti);
resizeConfetti();

function confettiBurst(x, y){
  const colors = ["#ffd86b","#ff4d9d","#ffffff","#7bf1ff","#b86bff"];
  const N = 180;
  for(let i=0;i<N;i++){
    confetti.push({
      x, y,
      vx: (Math.random()*10 - 5) * devicePixelRatio,
      vy: (Math.random()*-12 - 4) * devicePixelRatio,
      g: (0.22 + Math.random()*0.18) * devicePixelRatio,
      r: (3 + Math.random()*5) * devicePixelRatio,
      rot: Math.random()*Math.PI,
      vr: (Math.random()*0.25 - 0.125),
      life: 140 + Math.random()*70,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }
}
function drawConfetti(){
  cctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confetti = confetti.filter(p => p.life > 0);
  for(const p of confetti){
    p.life--;
    p.vy += p.g;
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;

    cctx.save();
    cctx.translate(p.x, p.y);
    cctx.rotate(p.rot);
    cctx.fillStyle = p.color;
    cctx.globalAlpha = Math.min(1, p.life/80);
    cctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
    cctx.restore();
  }
  requestAnimationFrame(drawConfetti);
}
drawConfetti();

/* =========================
   AUDIO
========================= */
function playSongFadeIn(audio, duration = 2500){
  audio.volume = 0;
  audio.currentTime = 0;
  audio.play().catch(()=>{});
  const steps = 24;
  const stepTime = duration / steps;
  let i = 0;

  const fade = setInterval(()=>{
    i++;
    audio.volume = Math.min(SONG_MAX_VOL, (i/steps) * SONG_MAX_VOL);
    if(i >= steps) clearInterval(fade);
  }, stepTime);
}

/* =========================
   TYPEWRITER
========================= */
function splitIntoSentences(paragraph){
  const parts = paragraph.replace(/\s+/g, " ").trim().match(/[^.!?]+[.!?]?\s*/g);
  return parts ? parts.map(s=>s.trim()).filter(Boolean) : [paragraph.trim()];
}
async function typeLine(el, textToType){
  el.textContent = "";
  for(let i=0;i<textToType.length;i++){
    el.textContent += textToType[i];
    await new Promise(r=>setTimeout(r, TYPE_SPEED));
  }
}
async function typewriterMessage(container, paragraphs){
  container.innerHTML = "";
  const lines = [];
  paragraphs.forEach(p => splitIntoSentences(p).forEach(s => lines.push(s)));

  for(const lineText of lines){
    const line = document.createElement("div");
    line.className = "line";
    container.appendChild(line);
    await typeLine(line, lineText);
  }

  const sig = document.createElement("div");
  sig.className = "signature";
  container.appendChild(sig);
  await typeLine(sig, "‚Äî Canzy üíõ");
}

/* =========================
   LOVE COUNTER
========================= */
function formatDuration(ms){
  const s = Math.floor(ms/1000);
  const days = Math.floor(s / 86400);
  const hrs = Math.floor((s % 86400) / 3600);
  const mins = Math.floor((s % 3600) / 60);
  const secs = s % 60;
  return `${days} days ‚Ä¢ ${hrs}h ${mins}m ${secs}s`;
}
function startCounter(){
  counterRow.classList.remove("hidden");
  const tick = ()=>{
    counterText.textContent = `‚è≥ Love counter: ${formatDuration(new Date() - LOVE_START)}`;
  };
  tick();
  setInterval(tick, 1000);
}

/* =========================
   LIGHTBOX (full size photo)
========================= */
function openLightbox(src){
  lightboxImg.src = src;
  lightbox.classList.add("show");
}
function closeLightbox(){
  lightbox.classList.remove("show");
  lightboxImg.src = "";
}
lightboxClose.addEventListener("click", closeLightbox);
lightbox.addEventListener("click", (e)=>{
  if(e.target === lightbox) closeLightbox();
});

/* Make both photos clickable */
photoBox1.addEventListener("click", ()=> openLightbox(photoImg1.src));
photoBox2.addEventListener("click", ()=> openLightbox(photoImg2.src));

/* =========================
   CANDLE BLOW
========================= */
let candleBlown = false;
function blowCandle(){
  if(candleBlown) return;
  candleBlown = true;

  flame.style.transition = "opacity 450ms ease, transform 450ms ease";
  flame.style.opacity = "0";
  flame.style.transform = "translateX(-50%) scale(.7)";

  smoke.classList.remove("run");
  void smoke.offsetWidth;
  smoke.classList.add("run");

  candleHint.textContent = "A wish for you‚Ä¶ üí´";

  // reveal photos area
  setTimeout(()=>{
    photoWrap.classList.add("show");
    // unblur photo 1 only
    setTimeout(()=>document.getElementById("photoBox1").classList.add("revealed"), 180);
    // scroll to photos nicely
    setTimeout(()=>photoWrap.scrollIntoView({behavior:"smooth", block:"center"}), 420);
  }, 650);
}
flame.addEventListener("click", blowCandle);

/* also clicking cake works */
cake.addEventListener("click", blowCandle);

/* =========================
   SECRET PRESENT (show photo2)
========================= */
secretBtn.addEventListener("click", ()=>{
  // show 2nd photo card and reveal it
  photoCard2.classList.remove("hidden");
  setTimeout(()=>document.getElementById("photoBox2").classList.add("revealed"), 120);

  // optional: change button text after open
  secretBtn.textContent = "‚ú® Present opened!";
  secretBtn.disabled = true;
  secretBtn.style.opacity = "0.85";

  // keep both photos centered in view
  setTimeout(()=>photoWrap.scrollIntoView({behavior:"smooth", block:"center"}), 250);
});

/* =========================
   MAIN CLICK (Continue)
========================= */
btn.onclick = async ()=>{
  try{
    click.currentTime = 0;
    click.volume = 0.95;
    click.play().catch(()=>{});
  }catch(e){}

  playSongFadeIn(song, 2500);
  document.body.classList.add("cinematic");

  const r = btn.getBoundingClientRect();
  confettiBurst((r.left + r.width/2) * devicePixelRatio, (r.top + r.height/2) * devicePixelRatio);

  intro.style.display = "none";
  btn.classList.add("fade");
  setTimeout(()=>btn.style.display="none", 350);

  candleWrap.classList.remove("hidden");

  text.classList.remove("hidden");
  requestAnimationFrame(()=>text.classList.add("show"));

  startCounter();

  const paragraphs = [
    "Happy Birthday to the girl who changed my world.",
    "You are the most beautiful chapter of my life. Every day with you feels like a blessing, but today is extra special because it‚Äôs the day the world received you.",
    "Thank you for your love, your smile, your patience, and the way you make my heart feel safe. I promise to stand beside you, support your dreams, and love you more with every passing year.",
    "May your birthday be as soft, warm, and magical as your hugs.",
    "I love you more than words can explain. üéÇüíò"
  ];

  await typewriterMessage(text, paragraphs);

  // gentle scroll down so candle/text are visible
  setTimeout(()=>window.scrollBy({ top: 120, behavior: "smooth" }), 250);
};
</script>

</body>
</html>
